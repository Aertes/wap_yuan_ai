<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./js/jquery-weui-build/css/jquery-weui.min.css">
    <link rel="stylesheet" href="./css/font-awesome.min.css">
    <link rel="stylesheet" href="./css/sufferer.css">
    <script src="./js/jquery-weui-build/lib/jquery-2.1.4.js"></script>
    <script src="./js/jquery-weui-build/js/jquery-weui.min.js"></script>
    <script src="./js/common.js"></script>
    <title>患者注册</title>
</head>
<body>
    <header class="header">
        <div class="title">
            <h1 class="f14">患者注册</h1>
        </div>
    </header>
    <section class="content">
        <section>
            <div class="logo w">
                <img src="./images/logo.png" alt="">
            </div>
        </section>
        <form class="register" id="formRegister">
            <div class="username input_text">
                <label for="">为了使您更好的参与上课讨论，<label for="">请您填写以下信息：</label></label>
                
                <span class="add-on"><i class="icon-user"></i></span>
                <input type="text" name="username" placeholder="请输入姓名">
            </div>
            <div class="birthday input_text">
                <span class="add-on"><i class="icon-calendar"></i></span>
                <input type="text" name="birthday" placeholder="请输入出生日期">
            </div>
            <div class="patientNumber input_text">
                <span class="add-on"><i class="icon-plus-sign-alt"></i></span>
                <input type="text" name="patientNumber" placeholder="请输入门诊号">
            </div>
            <div class="upload_case">
                <label for="">上传病例</label>
                <div class="upload_file clearfix">
                    <div class="upload_img odd">
                        <img src="./images/error.gif" alt="">
                    </div>
                    <div class="upload_img even">
                        <img src="./images/error.gif" alt="">
                    </div>
                    <div class="upload_btn">
                        <a href="javascript:;"></a>
                        <input type="file" name="file" id="upload_file">
                    </div>
                    <div class="upload_" style="">
                        <a href=""></a>
                    </div>
                </div>
            </div>
            <div class="phone input_text">
                <label for="">验证手机号（注：作为系统登录用户名）</label>
                <span class="add-on"><i class="icon-mobile-phone"></i></span>
                <input type="text" name="phone" placeholder="请输入手机号">
            </div>
            <div class="password input_text">
                <label for="">密码</label>
                <span class="add-on"><i class="icon-lock"></i></span>
                <input type="password" name="password" placeholder="请输入密码">
            </div>
            <div class="surgery">
                <label for="">现阶段治疗方法</label>
                <div class="radio">
                    <input type="radio" name="surgery" checked='checked' value="0">
                    <span class="surgery_checked">手术</span>
                    <input type="radio" name="non_surgical">
                    <span class="non_surgical_checked">非手术</span>
                </div>
            </div>
            <div class="medical_history">
                <textarea name="medical_history" id="medical_history" rows="10" placeholder="病例病史："></textarea>
                <p>字数不能超过100字</p>
            </div>
            <div class="code input_text">
                <label for="">推荐码</label>
                <span class="add-on"><i class="icon-barcode"></i></span>
                <input type="text" name="code" placeholder="邀请码">
            </div>
            <div class="informed_consent">
                <input id="informed_consent" type="checkbox" name="informed_consent" checked value="1">
                <span class="informed">知情同意书</span>
            </div>
        </form>
        <div class="register_btn">
            <button id="register_form" class="f14">提&nbsp;交</button>
        </div>
    </section>
    <div class="bg_model none"></div>
    <div class="modal_content none login_modal_content"></div>
    <script>
        
        $(function () {
            var flag = true;            
            $(document).delegate('.surgery_checked', 'click', function(){
                $('input[name=surgery]').prop('checked', true).val(0);
                $('input[name=non_surgical]').prop('checked', false).val('');
            })
            $(document).delegate('.non_surgical_checked', 'click', function () {
                $('input[name=surgery]').prop('checked', false).val('');
                $('input[name=non_surgical]').prop('checked', true).val(0);
            })
            $(document).delegate('.informed', 'click', function () {
                if(flag){
                    $('#informed_consent').prop('checked', false).val(0);
                    flag = false;
                }else{
                    $('#informed_consent').prop('checked', true).val(1);
                    flag = true;
                }
            })
            //表单验证
            $('#register_form').click(function () {
                var username = $('input[name=username]').val();
                var birthday = $('input[name=birthday]').val();
                var patientNumber = $('input[name=patientNumber]').val();
                var phone = $('input[name=phone]').val();
                var password = $('input[name=password]').val();
                var medical_history = $('#medical_history').val();
                if (username == '' || username == null) {
                    $('.bg_model').fadeIn();
                    $('.modal_content').fadeIn().text('请输入姓名');
                    timer();
                }else if(birthday == '' || birthday == null){
                    $('.bg_model').fadeIn();
                    $('.modal_content').fadeIn().text('请输入出生日期');
                    timer();
                }else if (patientNumber == '' || patientNumber == null) {
                    $('.bg_model').fadeIn();
                    $('.modal_content').fadeIn().text('请输入门诊号');
                    timer();
                }else if (phone == '' || phone == null) {
                    $('.bg_model').fadeIn();
                    $('.modal_content').fadeIn().text('请输入手机号');
                    timer();
                }else if(!checkPhone()) {
                    $('.bg_model').fadeIn();
                    $('.modal_content').fadeIn().text('请输入正确的手机号');
                    timer();
                }else if (password == '' || username == null) {
                    $('.bg_model').fadeIn();
                    $('.modal_content').fadeIn().text('请输入密码');
                    timer();
                }else if (medical_history.length <= 0) {
                    $('.bg_model').fadeIn();
                    $('.modal_content').fadeIn().text('请输入病例病史');
                    timer();
                } else if (medical_history.length >= 100) {
                    $('.bg_model').fadeIn();
                    $('.modal_content').fadeIn().text('请输入的病例病史字数不能超过100字');
                    timer();
                }else {
                    console.log($('#formRegister').serialize())
                    $.ajax({
                        url: '',
                        type: 'post',
                        data: $('#formRegister').serialize(),
                        success: function (data) {
                            if (data.type == "success") {
                                window.location.href = './index';
                            } else {
                                $('.bg_model').fadeIn();
                                $('.modal_content').fadeIn().text(data.message);
                                timer();
                            }
                        }
                    })
                }
            })
        })
    </script>
</body>

</html>